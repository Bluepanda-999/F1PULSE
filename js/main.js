const driversData = {
  verstappen: {
    name: "MAX VERSTAPPEN",
    birthDate: "1997-09-30",
    nationality: "Dutch",
    team: "Red Bull Racing",
    number: "1",
    bio: "Four-time World Champion. Known for fearless overtakes and ice-cold racecraft under pressure. Fifth Simply-Lovely",
    photo: "img/verstappen.jpg",
    sound: "audio/max.mp3"
  },
  norris: {
    name: "LANDO NORRIS",
    birthDate: "1999-11-13",
    nationality: "British",
    team: "McLaren",
    number: "4",
    bio: "Rising star with lightning pace. Consistently challenges for wins since 2023.",
    photo: "img/norris.jpg",
    sound: "audio/bye-lando-made-with-Voicemod.mp3"
  },
  hamilton: {
    name: "LEWIS HAMILTON",
    birthDate: "1985-01-07",
    nationality: "British",
    team: "Ferrari",
    number: "44",
    bio: "Seven-time World Champion. Joined Ferrari in 2025 in pursuit of an eighth title.",
    photo: "img/hamilton.jpg",
    sound: "audio/Maxx Power, Carte Blanq — Lewis Hamilton (www.lightaudio.ru).mp3"
  },
  leclerc: {
    name: "CHARLES LECLERC",
    birthDate: "1997-10-16",
    nationality: "Monegasque",
    team: "Ferrari",
    number: "16",
    bio: "Ferrari's lead driver. Exceptional qualifying pace and emotional race performances.",
    photo: "img/leclerc.jpg",
    sound: "audio/leclerc-kid-made-with-Voicemod.mp3"
  },
  tsunoda: {
    name: "YUKI TSUNODA",
    birthDate: "2000-05-11",
    nationality: "Japanese",
    team: "RB",
    number: "22",
    bio: "Aggressive and improving. Promoted to full Red Bull junior team leadership in 2025.",
    photo: "img/tsunoda.jpg",
    sound: "audio/i-pressed-the-radio-and-swear-because-i-don-t-have-to-press-the-radio-and-swear-but-i-don-t-know-what-just-happened-i-pr.mp3"
  },
  sainz: {
    name: "CARLOS SAINZ",
    birthDate: "1994-09-01",
    nationality: "Spanish",
    team: "Williams",
    number: "55",
    bio: "Veteran race-winner. Moved to Williams in 2025 to lead their revival project.",
    photo: "img/sainz.jpg",
    sound: "audio/smooth-operator.mp3"
  },
  bortoletto: {
    name: "GABRIEL BORTOLETTO",
    birthDate: "2004-07-20",
    nationality: "Brazilian",
    team: "Sauber",
    number: "30",
    bio: "F2 Champion 2024. Made F1 debut with Sauber in 2025 as part of Ferrari academy.",
    photo: "img/bortoletto.jpg",
    sound: "audio/bortoletto.mp3"
  },
  hadjar: {
    name: "ISACK HADJAR",
    birthDate: "2003-01-16",
    nationality: "French",
    team: "RB",
    number: "28",
    bio: "Red Bull junior prodigy. Promoted mid-2024, full-time in 2025 with RB.",
    photo: "img/hadjar.jpg",
    sound: "audio/hadjar.mp3"
  },
  doohan: {
    name: "JACK DOOHAN",
    birthDate: "2003-07-02",
    nationality: "Australian",
    team: "Alpine",
    number: "31",
    bio: "Son of MotoGP legend Mick Doohan. Alpine’s long-term development driver turned racer.",
    photo: "img/doohan.jpg",
    sound: "audio/doohan.mp3"
  },
  gasly: {
    name: "PIERRE GASLY",
    birthDate: "1996-02-07",
    nationality: "French",
    team: "Alpine",
    number: "10",
    bio: "2020 Italian GP winner. Alpine’s team leader with strong development input.",
    photo: "img/gasly.jpg",
    sound: "audio/gasly.mp3"
  },
  antonelli: {
    name: "ANDREA KIMI ANTONELLI",
    birthDate: "2006-08-23",
    nationality: "Italian",
    team: "Mercedes",
    number: "77",
    bio: "Teenage sensation. Called up by Mercedes in 2025 as Hamilton’s replacement-in-waiting.",
    photo: "img/antonelli.jpg",
    sound: "audio/kimi.mp3"
  },
  alonso: {
    name: "FERNANDO ALONSO",
    birthDate: "1981-07-29",
    nationality: "Spanish",
    team: "Aston Martin",
    number: "14",
    bio: "Two-time World Champion. Still racing at peak performance in his 40s.",
    photo: "img/alonso.jpg",
    sound: "audio/alonso.mp3"
  },
  stroll: {
    name: "LANCE STROLL",
    birthDate: "1998-10-29",
    nationality: "Canadian",
    team: "Aston Martin",
    number: "18",
    bio: "Team owner’s son. Solid midfield performer with occasional podium potential.",
    photo: "img/stroll.jpg",
    sound: "audio/stroll.mp3"
  },
  albon: {
    name: "ALEX ALBON",
    birthDate: "1996-03-23",
    nationality: "Thai-British",
    team: "Williams",
    team: "Williams",
    number: "23",
    bio: "Fan favorite. Known for tenacious defending and racecraft beyond car performance. WAG 2025",
    photo: "img/albon.jpg",
    sound: "audio/albon.mp3"
  },
  hulkenberg: {
    name: "NICO HULKENBERG",
    birthDate: "1987-08-19",
    nationality: "German",
    team: "Haas",
    number: "27",
    bio: "The 'eternal reserve'. Finally got a full seat in 2025 with Haas after years of stand-in duty.",
    photo: "img/hulkenberg.jpg",
    sound: "audio/hulkenberg.mp3"
  },
  lawson: {
    name: "LIAM LAWSON",
    birthDate: "2002-02-11",
    nationality: "New Zealander",
    team: "Haas",
    number: "40",
    bio: "Red Bull reserve turned Haas race driver. Aggressive style, improving consistency.",
    photo: "img/lawson.jpg",
    sound: "audio/lawson.mp3"
  },
  ocon: {
    name: "ESTEBAN OCON",
    birthDate: "1996-09-17",
    nationality: "French",
    team: "Haas",
    number: "31",
    bio: "2021 Hungarian GP winner. Joined Haas in 2025 after Alpine reshuffle.",
    photo: "img/ocon.jpg",
    sound: "audio/ocon.mp3"
  },
  colapinto: {
    name: "FRANCO COLAPINTO",
    birthDate: "1999-11-13",
    nationality: "Argentinian",
    team: "Williams",
    number: "43",
    bio: "F2 standout. Called up by Williams mid-2024, retained for full 2025 season.",
    photo: "img/colapinto.jpg",
    sound: "audio/colapinto.mp3"
  },
  piastri: {
    name: "OSCAR PIASTRI",
    birthDate: "2001-04-06",
    nationality: "Australian",
    team: "McLaren",
    number: "81",
    bio: "2023 Rookie of the Year. Now a championship contender with McLaren’s 2025 challenger.",
    photo: "img/piastri.jpg",
    sound: "audio/piastri.mp3"
  },
  russell: {
    name: "GEORGE RUSSELL",
    birthDate: "1998-02-15",
    nationality: "British",
    team: "Mercedes",
    number: "63",
    bio: "Precise, fast, and strategic. Mercedes’ lead driver in the post-Hamilton transition.",
    photo: "img/russell.jpg",
    sound: "audio/russell.mp3"
  },
  bearman: {
    name: "OLIVER BEARMAN",
    birthDate: "2005-07-26",
    nationality: "British",
    team: "Sauber",
    number: "42",
    bio: "Ferrari junior. Made shock debut in 2024, now full-time with Sauber in 2025.",
    photo: "img/bearman.jpg",
    sound: "audio/bearman.mp3"
  }
};

function getAge(birthDateStr) {
  const today = new Date();
  const birthDate = new Date(birthDateStr);
  let age = today.getFullYear() - birthDate.getFullYear();
  const monthDiff = today.getMonth() - birthDate.getMonth();
  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
    age--;
  }
  return age;
}
 
function getZodiacSign(birthDateStr) {
  const date = new Date(birthDateStr);
  const day = date.getDate();
  const month = date.getMonth() + 1;

  if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return "Aries ♈";
  if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return "Taurus ♉";
  if ((month === 5 && day >= 21) || (month === 6 && day <= 20)) return "Gemini ♊";
  if ((month === 6 && day >= 21) || (month === 7 && day <= 22)) return "Cancer ♋";
  if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return "Leo ♌";
  if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return "Virgo ♍";
  if ((month === 9 && day >= 23) || (month === 10 && day <= 22)) return "Libra ♎";
  if ((month === 10 && day >= 23) || (month === 11 && day <= 21)) return "Scorpio ♏";
  if ((month === 11 && day >= 22) || (month === 12 && day <= 21)) return "Sagittarius ♐";
  if ((month === 12 && day >= 22) || (month === 1 && day <= 19)) return "Capricorn ♑";
  if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return "Aquarius ♒";
  if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return "Pisces ♓";
  
  return "Unknown";
}

// KGB: Full driver dossier system with bio, age, zodiac, photo, sound & modal
$(document).ready(function() {
  // Fade-in animation
  $('.driver-card, .track-preview').hide().fadeIn(800);

  let currentAudio = null;

  // Single click handler for all drivers
  $('.driver-card').on('click', function() {
    const driverId = $(this).data('driver');
    const data = driversData[driverId];

    if (!data) return;

    // Stop previous sound
    if (currentAudio) {
      currentAudio.pause();
      currentAudio = null;
    }

    // === Fill basic info ===
    $('#modalDriverName').text(data.name);
    $('#modalNationality').text(data.nationality);
    $('#modalTeam').text(data.team);
    $('#modalNumber').text(data.number);
    $('#modalBio').text(data.bio);

    // === Handle photo with fallback ===
    const $img = $('#modalDriverPhoto');
    $img.attr('src', data.photo).off('error').on('error', function() {
      $(this).attr('src', 'img/driver-placeholder.jpg').addClass('opacity-50');
    });

   // === Compute and display Age & Zodiac ===
let age = "—";
let zodiac = "—";
let ageText = "—";

if (data.birthDate) {
  const birth = new Date(data.birthDate);
  const now = new Date();
  
  // Age
  age = now.getFullYear() - birth.getFullYear();
  if (now.getMonth() < birth.getMonth() || 
     (now.getMonth() === birth.getMonth() && now.getDate() < birth.getDate())) {
    age--;
  }

  // Formatted birthday
  const day = String(birth.getDate()).padStart(2, '0');
  const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun",
                      "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
  const month = monthNames[birth.getMonth()];
  const year = birth.getFullYear();
  ageText = `${day} ${month} ${year} (${age} years)`;

  // Zodiac
  const d = birth.getDate();
  const m = birth.getMonth() + 1;
  if ((m === 3 && d >= 21) || (m === 4 && d <= 19)) zodiac = "Aries ♈";
  else if ((m === 4 && d >= 20) || (m === 5 && d <= 20)) zodiac = "Taurus ♉";
  else if ((m === 5 && d >= 21) || (m === 6 && d <= 20)) zodiac = "Gemini ♊";
  else if ((m === 6 && d >= 21) || (m === 7 && d <= 22)) zodiac = "Cancer ♋";
  else if ((m === 7 && d >= 23) || (m === 8 && d <= 22)) zodiac = "Leo ♌";
  else if ((m === 8 && d >= 23) || (m === 9 && d <= 22)) zodiac = "Virgo ♍";
  else if ((m === 9 && d >= 23) || (m === 10 && d <= 22)) zodiac = "Libra ♎";
  else if ((m === 10 && d >= 23) || (m === 11 && d <= 21)) zodiac = "Scorpio ♏";
  else if ((m === 11 && d >= 22) || (m === 12 && d <= 21)) zodiac = "Sagittarius ♐";
  else if ((m === 12 && d >= 22) || (m === 1 && d <= 19)) zodiac = "Capricorn ♑";
  else if ((m === 1 && d >= 20) || (m === 2 && d <= 18)) zodiac = "Aquarius ♒";
  else if ((m === 2 && d >= 19) || (m === 3 && d <= 20)) zodiac = "Pisces ♓";
}

$('#modalAge').text(ageText);
$('#modalZodiac').text(zodiac);

    // === Play sound ===
    const soundPath = data.sound || "audio/dossier-open.mp3";
    currentAudio = new Audio(soundPath);
    currentAudio.play().catch(e => console.log("Audio play failed:", e));

    // === Show modal ===
    $('#driverModal').modal('show');
  });

  // Stop sound when modal is closed
  $('#driverModal').on('hidden.bs.modal', function () {
    if (currentAudio) {
      currentAudio.pause();
      currentAudio = null;
    }
  });
});